<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Source: lib/index.js | Watson Developer Cloud Node.js SDK Documentation</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: lib/index.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Copyright 2014 IBM Corp. All Rights Reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

'use strict';

var path         = require('path');
var fs           = require('fs');
var util         = require('util');
var extend       = require('extend');
var vcapServices = require('vcap_services');
var helper       = require('./helper');
var omit         = require('object.omit');
var request      = require('request');

function encodeBase64(creds) {
  return new Buffer(creds.username + ':' + creds.password).toString('base64');
}

/**
 * @private
 * @param serviceName
 * @returns {Function}
 */
function createServiceAPI(serviceName) {
  // this function is about twice as complex as our rules allow!
  // eslint-disable-next-line complexity
  return function(user_options) {
    var options = extend({}, user_options);
    var alchemy = (serviceName.indexOf('alchemy_') === 0);
    var vrv3 = (serviceName === 'visual_recognition' &amp;&amp; user_options.version === 'v3');

    // For Alchemy we use 'v1' by default,
    // and check if `apikey` was specified.
    // We don't use VCAP_SERVICES
    if (alchemy) {
      options.alchemy = true;
      options.version = 'v1';
      options.api_key = options.apikey || options.api_key;
    } else if (vrv3) {
      // Visual Recognition v3 similarly uses an API key instead of username + password
      options.api_key = options.apikey || options.api_key;
    } else {
      options.jar = request.jar();
    }

    // Check if 'version' was provided
    var version = options.version;
    if (typeof version === 'undefined') {
      throw new Error('Argument error: version was not specified');
    }

    // Get credentials from Bluemix
    if (options.use_vcap_services !== false) {
      var vcap_services_name = vrv3 ?  'watson_vision_combined' : serviceName;
      var credentials = vcapServices.getCredentials(vcap_services_name);
      if (serviceName === 'language_translator' &amp;&amp; !Object.keys(credentials).length) {
        // the language translation service was renamed to language translator, but there are still old instances floating around with credentials specifying the old name
        credentials = vcapServices.getCredentials('language_translation');
      }
      if (credentials.username &amp;&amp; credentials.password) {
        credentials.api_key = encodeBase64(credentials);
      }
      options = extend({}, options, credentials);
    }

    // Use api_key or username and password as Authorization
    var user = options.username,
      pass = options.password,
      api_key = options.api_key;

    if (!options.use_unauthenticated) {
      // Check if 'api_key' or 'username' and 'password' were provided
      if (typeof api_key === 'undefined') {
        if (typeof user === 'undefined' || typeof pass === 'undefined') {
          if (alchemy || vrv3)
            throw new Error('Argument error: api_key was not specified');
          else
            throw new Error('Argument error: api_key or username and password were not specified');
        }

        // Calculate and add api_key
        options.api_key = new Buffer(user + ':' + pass).toString('base64');
      }
    }

    options = omit(options, ['version', 'username', 'password',
      'use_vcap_services', 'use_unauthenticated', 'apikey']);

    if (options.url)
      options.url = helper.stripTrailingSlash(options.url);

    try {
      // Build the path to the service file based on the service name and api version
      var servicePath = path.join(__dirname, '..', 'services', serviceName, path.basename(version));
      var Service = require(servicePath);
      var s = new Service(options);
      return Object.freeze(s);
    } catch (e) {
      if (e.code === 'MODULE_NOT_FOUND') {

        // give a clear error message for services that have been sunset, with the replacement when possible
        if (serviceName === 'search') {
          throw new Error('The search service has been replaced by retrieve_and_rank');
        }
        if (serviceName === 'tone_analyzer' &amp;&amp; path.basename(version) === 'v3-beta') {
          throw new Error('tone_analyzer v3-beta has been replaced by v3');
        }

        // for the v1.0 breaking change of requiring experimental/beta in the module name, try to offer a helpful error message.
        // https://github.com/watson-developer-cloud/node-sdk/issues/43
        var msg = 'Service %s %s not found.';
        if (fs.existsSync(path.join(__dirname, '..', 'services', serviceName, path.basename(version) + '-beta.js'))) {
          msg += ' Did you mean ' + path.basename(version) + '-beta?';
        }
        if (fs.existsSync(path.join(__dirname, '..', 'services', serviceName, path.basename(version) + '-experimental.js'))) {
          msg += ' Did you mean ' + path.basename(version) + '-experimental?';
        }

        throw new Error(util.format(msg, serviceName, version));
      } else {
        throw e;
      }
    }
  };
}

/**
 * @namespace
 */
var watson = {
  /**
   * @function
   * @param {{}} options
   * @returns  {RelationshipExtraction}
   */
  relationship_extraction: createServiceAPI('relationship_extraction'),

  /**
   * @function
   * @param {{}} options
   * @returns  {VisualRecognitionV1Beta|VisualRecognitionV2Beta|VisualRecognitionV3}
   */
  visual_recognition: createServiceAPI('visual_recognition'),

  /**
   * @function
   * @param {{}} options
   * @returns  {SpeechToText}
   */
  speech_to_text: createServiceAPI('speech_to_text'),

  /**
   * @function
   * @param {{}} options
   * @returns  {TextToSpeech}
   */
  text_to_speech: createServiceAPI('text_to_speech'),

  /**
   * @function
   * @param {{}} options
   * @returns  {ConceptInsights}
   */
  concept_insights: createServiceAPI('concept_insights'),

  /**
   * @function
   * @param {{}} options
   * @returns  {TradeoffAnalytics}
   */
  tradeoff_analytics: createServiceAPI('tradeoff_analytics'),

  /**
   * @function
   * @param {{}} options
   * @returns  {PersonalityInsights}
   */
  personality_insights: createServiceAPI('personality_insights'),

  /**
   * @function
   * @param {{}} options
   * @returns  {NaturalLanguageClassifier}
   */
  natural_language_classifier: createServiceAPI('natural_language_classifier'),

  /**
   * @function
   * @param {{}} options
   * @returns  {Authorization}
   */
  authorization: createServiceAPI('authorization'),

  /**
   * @function
   * @param {{}} options
   * @returns  {LanguageTranslation}
   */
  language_translator: createServiceAPI('language_translator'),

  /**
   * @function
   * @param {{}} options
   * @returns  {ToneAnalyzer}
   */
  tone_analyzer: createServiceAPI('tone_analyzer'),

  /**
   * @function
   * @param {{}} options
   * @returns  {Dialog}
   */
  dialog: createServiceAPI('dialog'),

  /**
   * @function
   * @param {{}} options
   * @returns  {RetrieveAndRank}
   */
  retrieve_and_rank: createServiceAPI('retrieve_and_rank'),

  /**
   * @function
   * @param {{}} options
   * @returns  {DocumentConversion}
   */
  document_conversion: createServiceAPI('document_conversion'),

  // deprecated
  /**
   * @function
   * @param {{}} options
   * @returns  {Search}
   * @deprecated Replaced by {@link RetrieveAndRank}
   */
  search: createServiceAPI('search'),

  // alchemy
  /**
   * @function
   * @param {{}} options
   * @returns  {AlchemyLanguage}
   */
  alchemy_language: createServiceAPI('alchemy_language'),

  /**
   * @function
   * @param {{}} options
   * @returns  {AlchemyVision}
   */
  alchemy_vision: createServiceAPI('alchemy_vision'),

  /**
   * @function
   * @param {{}} options
   * @returns  {AlchemyDataNews}
   */
  alchemy_data_news: createServiceAPI('alchemy_data_news'),

  /**
   * @function
   * @param {{}} options
   * @returns  {ConceptExpansion}
   */
  conversation: createServiceAPI('conversation')
};

// removed services
// we don't want these services listed (so non-enumerable), but we do want a clear error message
// if old code happens to try using one
['message_resonance', 'question_and_answer', 'visual_insights', 'concept_expansion'].forEach(function(serviceName) {
  Object.defineProperty(watson, serviceName, {
    enumerable: false,
    configurable: true,
    writable: true,
    value: function() {
      throw new Error('The ' + serviceName + ' service is no longer available');
    }
  });
});

Object.defineProperty(watson, 'language_translation', {
  enumerable: false,
  configurable: true,
  writable: true,
  value: function(options) {
    if (!options.silent) {
      //eslint-disable-next-line no-console
      console.warn(new Error("Watson language_translation is now language_translator. Set {silent: true} to disable this message.").stack)
    }
    return watson.language_translator(options);
  }
});

module.exports = watson;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="AlchemyDataNews.html">AlchemyDataNews</a></li><li><a href="AlchemyLanguage.html">AlchemyLanguage</a></li><li><a href="AlchemyVision.html">AlchemyVision</a></li><li><a href="Authorization.html">Authorization</a></li><li><a href="ConceptInsights.html">ConceptInsights</a></li><li><a href="Conversation.html">Conversation</a></li><li><a href="Dialog.html">Dialog</a></li><li><a href="DocumentConversion.html">DocumentConversion</a></li><li><a href="LanguageTranslation.html">LanguageTranslation</a></li><li><a href="NaturalLanguageClassifier.html">NaturalLanguageClassifier</a></li><li><a href="PersonalityInsights.html">PersonalityInsights</a></li><li><a href="RecognizeStream.html">RecognizeStream</a></li><li><a href="RelationshipExtraction.html">RelationshipExtraction</a></li><li><a href="RetrieveAndRank.html">RetrieveAndRank</a></li><li><a href="SpeechToText.html">SpeechToText</a></li><li><a href="TextToSpeech.html">TextToSpeech</a></li><li><a href="TradeoffAnalytics.html">TradeoffAnalytics</a></li><li><a href="VisualRecognitionV3.html">VisualRecognitionV3</a></li></ul><h3>Events</h3><ul><li><a href="RecognizeStream.html#event:close">close</a></li><li><a href="RecognizeStream.html#event:data">data</a></li><li><a href="RecognizeStream.html#event:error">error</a></li><li><a href="RecognizeStream.html#event:results">results</a></li></ul><h3>Namespaces</h3><ul><li><a href="watson.html">watson</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Mon Jul 11 2016 15:11:49 GMT+0000 (UTC)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
<script>
    (function(i,s,o,g,r,a,m){i["GoogleAnalyticsObject"]=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,"script","//www.google-analytics.com/analytics.js","ga");
    ga("create", "UA-59827755-9", "auto");
    ga("send", "pageview");
</script>
</body>
</html>
